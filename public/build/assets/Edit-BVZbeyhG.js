import{j as e,t as w,r as y,G as K,L as S,a as T,H as O,b as P}from"./app-CgQ5_Exw.js";import{a as L,P as M,L as A,M as $,T as B}from"./TileLayer-HGqYT74n.js";import{u as J}from"./hooks-DVhXcmX4.js";import{B as F}from"./building-2-BLckgE2I.js";import{M as H}from"./map-pin-CoMb9nXS.js";import{P as U}from"./phone-Drrb34sm.js";import{M as G}from"./mail-D1tLW4vh.js";import{B as R}from"./bed-double-DZQQsuq9.js";import{E as z}from"./image-C6w9k6vq.js";import{X as D}from"./avatar-CqAQLXEM.js";import{P as q}from"./preview-edit-klinik-B4ZuTmHv.js";import{A as V,b as I,c as W,d as Q,g as X,e as Z,f as Y,h as ee}from"./alert-dialog-Ib_-xiso.js";import{A as ae}from"./app-layout-t2dowiqj.js";import"./app-BKSfwL7n.js";import"./utils-B4smH_VX.js";import"./index-Bg-JEsM4.js";import"./circle-check-icf0PL4F.js";import"./users-D_KveccA.js";import"./activity-SOJQtf4g.js";import"./index-CwTnP0Ax.js";import"./index-D6pdehZ5.js";import"./index-CJy58a3f.js";import"./button-BJRDkhjt.js";import"./index-Dt6uqdf4.js";import"./index-DYp1igiw.js";import"./index-4Ns3tNZl.js";import"./settings-tEfU3Xeu.js";const te=({value:a,onChange:l})=>{const i=a.filter(r=>!r.tutup).length,x=r=>!a[r].tutup&&i===1,p=(r,n)=>{if(!a[r].tutup&&n&&i===1){w.error("Minimal 1 hari harus buka",{description:"Pastikan minimal 1 hari tidak dicentang tutup"});return}const s=[...a];s[r]={...s[r],tutup:n,jam_buka:n?null:s[r].jam_buka,jam_tutup:n?null:s[r].jam_tutup},l(s)};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[e.jsxs("label",{className:"block text-sm font-semibold text-gray-800",children:["Jam Operasional ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("span",{className:"rounded-full bg-emerald-100 px-2 py-1 text-xs text-emerald-700",children:"Wajib"}),i===1&&e.jsxs("span",{className:"rounded-full bg-emerald-100 px-2 py-1 text-xs text-emerald-700",children:[i," hari buka"]})]}),e.jsx("div",{className:"space-y-3",children:a.map((r,n)=>{const s=r.tutup,g=x(n);return e.jsx("div",{className:`rounded-xl border p-4 ${s?"bg-gray-50":"bg-white"} ${g?"border-emerald-200":""}`,children:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center",children:[e.jsxs("div",{className:"w-full md:w-32",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-800",children:r.hari}),g&&e.jsx("p",{className:"mt-1 text-xs text-emerald-600",children:"Hari ini harus buka"})]}),e.jsxs("div",{className:"flex flex-1 gap-3",children:[e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsxs("label",{className:`mb-1 text-xs ${s?"text-gray-400":"text-gray-500"}`,children:["Jam Buka ",s&&"(Tutup)",!s&&e.jsx("span",{className:"ml-1 text-red-500",children:"*"})]}),e.jsx("input",{type:"time",disabled:s,value:r.jam_buka||"",onChange:c=>{const m=[...a];m[n]={...m[n],jam_buka:c.target.value||null},l(m)},className:"rounded-lg border border-gray-200 px-3 py-2 text-sm focus:border-emerald-500 focus:ring-2 focus:ring-emerald-500/20 disabled:bg-gray-100",required:!s})]}),e.jsxs("div",{className:"flex w-full flex-col",children:[e.jsxs("label",{className:`mb-1 text-xs ${s?"text-gray-400":"text-gray-500"}`,children:["Jam Tutup ",s&&"(Tutup)",!s&&e.jsx("span",{className:"ml-1 text-red-500",children:"*"})]}),e.jsx("input",{type:"time",disabled:s,value:r.jam_tutup||"",onChange:c=>{const m=[...a];m[n]={...m[n],jam_tutup:c.target.value||null},l(m)},className:"rounded-lg border border-gray-200 px-3 py-2 text-sm focus:border-emerald-500 focus:ring-2 focus:ring-emerald-500/20 disabled:bg-gray-100",required:!s})]})]}),e.jsxs("div",{className:"flex items-center gap-2 md:w-24",children:[e.jsx("input",{type:"checkbox",checked:s,onChange:c=>p(n,c.target.checked),className:"h-4 w-4 text-emerald-600",disabled:g}),e.jsx("span",{className:`text-sm ${g?"text-gray-400":"text-gray-700"}`,children:"Tutup"})]})]})},r.hari)})})]})},se=A.icon({iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png"});A.Marker.prototype.options.icon=se;const re=({latitude:a,longitude:l,setData:i})=>{const[x,p]=y.useState([Number(a)||-7.7956,Number(l)||110.3695]);return J({click(r){p([r.latlng.lat,r.latlng.lng]),i("latitude",r.latlng.lat),i("longitude",r.latlng.lng)}}),e.jsx(L,{draggable:!0,position:x,eventHandlers:{dragend:r=>{const s=r.target.getLatLng();p([s.lat,s.lng]),i("latitude",s.lat),i("longitude",s.lng)}},children:e.jsx(M,{children:"Geser marker atau klik peta untuk ubah posisi."})})},le=({data:a,setData:l,handleSubmit:i,handleChangeFile:x,processing:p,isDirty:r,errors:n={},fasilitas:s=[]})=>{const[g,c]=K.useState(""),m=y.useRef(null),[_,N]=K.useState([]);return y.useEffect(()=>{function t(h){m.current&&!m.current.contains(h.target)&&N([])}return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[]),e.jsx("form",{onSubmit:i,autoComplete:"off",children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"space-y-6 rounded-xl border border-gray-200 bg-white p-6 shadow-sm",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"mb-2 flex items-center gap-2 text-sm font-medium text-gray-700",children:[e.jsx(F,{className:"h-4 w-4 text-emerald-600"}),"Nama Klinik",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:a.nama_klinik,onChange:t=>l("nama_klinik",t.target.value),className:"w-full rounded-lg border border-gray-200 px-4 py-2.5 text-sm text-gray-700 transition focus:border-emerald-500 focus:ring-2 focus:ring-emerald-500/20",placeholder:"Masukkan Nama klinik"}),n.nama_klinik&&e.jsx("p",{className:"mt-1 text-xs text-red-500",children:n.nama_klinik})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:["Jenis Klinik ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{value:a.jenis_klinik,onChange:t=>l("jenis_klinik",t.target.value),className:"w-full rounded-lg border border-gray-200 px-4 py-2.5 text-sm text-gray-700",children:[e.jsx("option",{value:"",children:"Pilih Jenis Klinik"}),e.jsx("option",{value:"Umum",children:"Umum"}),e.jsx("option",{value:"Gigi",children:"Gigi"}),e.jsx("option",{value:"Kebidanan & Kandungan",children:"Kebidanan & Kandungan"}),e.jsx("option",{value:"Anak",children:"Anak"}),e.jsx("option",{value:"Kulit & Kelamin",children:"Kulit & Kelamin"}),e.jsx("option",{value:"THT",children:"THT"}),e.jsx("option",{value:"Mata",children:"Mata"}),e.jsx("option",{value:"Fisioterapi",children:"Fisioterapi"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"mb-2 flex items-center gap-2 text-sm font-medium text-gray-700",children:[e.jsx(H,{className:"h-4 w-4 text-emerald-600"})," ","Alamat ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:a.alamat,onChange:t=>l("alamat",t.target.value),className:"w-full rounded-lg border border-gray-200 px-4 py-2.5 text-sm text-gray-700",placeholder:"Alamat lengkap"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",value:a.kota,onChange:t=>l("kota",t.target.value),className:"rounded-lg border border-gray-200 px-4 py-2.5 text-sm text-gray-700",placeholder:"Kota"}),e.jsx("input",{type:"text",value:a.provinsi,onChange:t=>l("provinsi",t.target.value),className:"rounded-lg border border-gray-200 px-4 py-2.5 text-sm text-gray-700",placeholder:"Provinsi"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"mb-2 flex items-center gap-2 text-sm font-medium text-gray-700",children:[e.jsx(U,{className:"h-4 w-4 text-emerald-600"}),"Telepon ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:a.no_telepon,onChange:t=>l("no_telepon",t.target.value),className:"w-full rounded-lg border border-gray-200 px-4 py-2.5 text-sm text-gray-700"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"mb-2 flex items-center gap-2 text-sm font-medium text-gray-700",children:[e.jsx(G,{className:"h-4 w-4 text-emerald-600"})," ","Email"]}),e.jsx("input",{type:"email",value:a.email,onChange:t=>l("email",t.target.value),className:"w-full rounded-lg border border-gray-200 px-4 py-2.5 text-sm text-gray-700"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"mb-2 flex items-center gap-2 text-sm font-medium text-gray-700",children:[e.jsx(R,{className:"h-4 w-4 text-emerald-600"})," ","Kapasitas Total"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",value:a.kapasitas_total,onChange:t=>l("kapasitas_total",Number(t.target.value)),className:"w-full rounded-lg border border-gray-200 px-4 py-2.5 text-sm"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"mb-2 flex items-center gap-2 text-sm font-medium text-gray-700",children:["Tempat Tersedia"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",value:a.kapasitas_tersedia,onChange:t=>l("kapasitas_tersedia",Number(t.target.value)||0),className:"w-full rounded-lg border border-gray-200 px-4 py-2.5 text-sm"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"mb-2 flex items-center gap-2 text-sm font-medium text-gray-700",children:[e.jsx(z,{className:"h-4 w-4 text-emerald-600"}),"Koordinat Lokasi"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",disabled:!0,placeholder:"Latitude",value:a.latitude,onChange:t=>l("latitude",t.target.value),className:"rounded-lg border border-gray-200 bg-gray-100 px-4 py-2.5 text-sm text-gray-700 transition focus:border-emerald-500 focus:ring-2 focus:ring-emerald-500/20"}),e.jsx("input",{type:"text",disabled:!0,placeholder:"Longitude",value:a.longitude,onChange:t=>l("longitude",t.target.value),className:"rounded-lg border border-gray-200 bg-gray-100 px-4 py-2.5 text-sm text-gray-700 transition focus:border-emerald-500 focus:ring-2 focus:ring-emerald-500/20"})]})]}),e.jsx("div",{className:"mt-4 h-[300px] w-full overflow-hidden rounded-lg border border-gray-200",children:e.jsxs($,{center:[Number(a.latitude)||-7.7956,Number(a.longitude)||110.3695],zoom:13,style:{height:"100%",width:"100%"},scrollWheelZoom:!0,children:[e.jsx(B,{attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(re,{latitude:a.latitude,longitude:a.longitude,setData:l})]})}),e.jsxs("div",{children:[e.jsxs("label",{className:"mb-2 flex items-center gap-2 text-sm font-medium text-gray-700",children:["Deskripsi ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:a.deskripsi,onChange:t=>l("deskripsi",t.target.value),rows:4,placeholder:"Tuliskan deskripsi singkat tentang klinik...",className:"w-full resize-none rounded-lg border border-gray-200 px-4 py-2.5 text-sm text-gray-700 transition focus:border-emerald-500 focus:ring-2 focus:ring-emerald-500/20"})]}),e.jsxs("div",{className:"relative",ref:m,children:[e.jsxs("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:["Fasilitas ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:g,onChange:t=>{const h=t.target.value;c(h),N(s.filter(f=>f.nama.toLowerCase().includes(h.toLowerCase())))},placeholder:"Cari fasilitas...",className:"w-full rounded-lg border px-3 py-2 text-sm"}),_.length>0&&e.jsx("ul",{className:"absolute z-10 mt-1 w-full rounded-lg border bg-white shadow",children:_.map(t=>e.jsx("li",{onClick:()=>{a.fasilitas.includes(t.id)||l("fasilitas",[...a.fasilitas,t.id]),c(""),N([])},className:"cursor-pointer px-4 py-2 hover:bg-gray-100",children:t.nama},t.id))}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:a.fasilitas.map(t=>{const h=s.find(f=>f.id===t);return e.jsxs("span",{className:"inline-flex items-center rounded-full bg-emerald-100 px-3 py-1 text-sm text-emerald-700",children:[h?.nama,e.jsx("button",{type:"button",onClick:()=>l("fasilitas",a.fasilitas.filter(f=>f!==t)),className:"ml-2 text-emerald-600 hover:text-emerald-800",children:e.jsx(D,{size:14})})]},t)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Gambar"}),e.jsx("input",{type:"file",accept:"image/*",onChange:x,className:"block w-full cursor-pointer rounded-lg border border-gray-200 text-sm text-gray-500 file:mr-4 file:rounded-lg file:border-0 file:bg-emerald-50 file:px-4 file:py-2 file:text-sm file:font-semibold file:text-emerald-700 hover:file:bg-emerald-100"})]})]}),e.jsxs("div",{className:"space-y-6 rounded-xl border border-gray-200 bg-white shadow-sm",children:[e.jsx(te,{value:a.jam_operasional,onChange:t=>l("jam_operasional",t)}),e.jsxs("div",{className:"mt-4 flex justify-end gap-3 rounded-b-xl border-t border-gray-200 bg-gray-50 px-6 py-4",children:[e.jsx(S,{href:"/admin/klinik",className:"rounded-lg border border-gray-200 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Batal"}),e.jsx("button",{type:"submit",disabled:p||!r,className:`rounded-lg px-4 py-2.5 text-sm font-medium text-white transition disabled:cursor-not-allowed ${p||!r?"bg-emerald-600 opacity-50":"bg-emerald-600 hover:bg-emerald-700"}`,children:p?"Menyimpan...":"Simpan Perubahan"})]})]})]})})},ie=[{title:"Klinik Kamu",href:"/admin/klinik"},{title:"Edit Klinik Kamu",href:""}];function Le({klinik:a,fasilitas:l}){const{data:i,setData:x,processing:p,errors:r}=T({nama_klinik:a.nama_klinik??"",jenis_klinik:a.jenis_klinik??"",alamat:a.alamat??"",kota:a.kota??"",provinsi:a.provinsi??"",no_telepon:a.no_telepon??"",email:a.email??"",deskripsi:a.deskripsi??"",latitude:a.latitude??"",longitude:a.longitude??"",kapasitas_total:a.kapasitas_total??0,kapasitas_tersedia:a.kapasitas_tersedia??0,punya_apoteker:!!a.punya_apoteker,punya_server:!!a.punya_server,gambar:void 0,fasilitas:a.fasilitas?.map(d=>d.id)??[],jam_operasional:a.jam_operasional??[{hari:"Senin",jam_buka:"",jam_tutup:"",tutup:!1},{hari:"Selasa",jam_buka:"",jam_tutup:"",tutup:!1},{hari:"Rabu",jam_buka:"",jam_tutup:"",tutup:!1},{hari:"Kamis",jam_buka:"",jam_tutup:"",tutup:!1},{hari:"Jumat",jam_buka:"",jam_tutup:"",tutup:!1},{hari:"Sabtu",jam_buka:"",jam_tutup:"",tutup:!0},{hari:"Minggu",jam_buka:"",jam_tutup:"",tutup:!0}]}),[n,s]=y.useState(!1),[g,c]=y.useState(!1),m=(d,u)=>JSON.stringify(d)===JSON.stringify(u);y.useEffect(()=>{const d={nama_klinik:a.nama_klinik??"",jenis_klinik:a.jenis_klinik??"",alamat:a.alamat??"",kota:a.kota??"",provinsi:a.provinsi??"",no_telepon:a.no_telepon??"",email:a.email??"",deskripsi:a.deskripsi??"",latitude:a.latitude??"",longitude:a.longitude??"",kapasitas_total:a.kapasitas_total??0,kapasitas_tersedia:a.kapasitas_tersedia??0,punya_apoteker:!!a.punya_apoteker,punya_server:!!a.punya_server};c(!m(i,d))},[i,a]);const[_,N]=y.useState(a.gambar?`/storage/${a.gambar}`:null),t=d=>{if(d.target.files&&d.target.files[0]){const u=d.target.files[0];x("gambar",u),N(URL.createObjectURL(u))}},h=()=>{const d=i.jam_operasional;for(const u of d)if(!u.tutup&&(!u.jam_buka||!u.jam_tutup))return`Jam buka dan jam tutup harus diisi untuk hari ${u.hari}`;return null},f=d=>{const u=h();if(u){w.error("Validasi gagal",{description:u});return}const b=new FormData;Object.entries(i).forEach(([v,j])=>{v==="fasilitas"?j.forEach(C=>b.append("fasilitas[]",String(C))):v==="jam_operasional"?j.map(o=>({hari:o.hari,jam_buka:o.tutup?null:o.jam_buka&&o.jam_buka!==""?o.jam_buka:null,jam_tutup:o.tutup?null:o.jam_tutup&&o.jam_tutup!==""?o.jam_tutup:null,tutup:o.tutup})).forEach((o,k)=>{b.append(`jam_operasional[${k}][hari]`,o.hari),b.append(`jam_operasional[${k}][tutup]`,o.tutup?"1":"0"),o.jam_buka!==null&&b.append(`jam_operasional[${k}][jam_buka]`,o.jam_buka),o.jam_tutup!==null&&b.append(`jam_operasional[${k}][jam_tutup]`,o.jam_tutup)}):j instanceof Blob?b.append(v,j):j!=null&&b.append(v,String(j))}),P.post(`/admin/klinik/${a.id}?_method=PUT`,b,{onSuccess:()=>{w.success("Klinik berhasil diperbarui",{description:"Data klinik telah berhasil disimpan ke sistem."}),s(!1)},onError:v=>{w.error("Gagal memperbarui klinik",{description:"Terjadi kesalahan saat menyimpan data klinik."}),s(!1)}})},E=d=>{d.preventDefault(),s(!0)};return e.jsxs(ae,{breadcrumbs:ie,children:[e.jsx(O,{title:"Edit Klinik Kamu"}),e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"mb-1 text-2xl font-semibold text-gray-900",children:"Edit Data Klinik"}),e.jsx("p",{className:"mb-6 text-sm text-gray-500",children:"Perbarui informasi klinik di bawah ini."}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-3",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(le,{data:i,setData:x,isDirty:g,handleSubmit:E,handleChangeFile:t,processing:p,errors:r,fasilitas:l})}),e.jsx("div",{className:"self-start",children:e.jsx(q,{data:{...i,preview:_}})})]}),e.jsx(V,{open:n,onOpenChange:s,children:e.jsxs(I,{className:"modal-over-map",children:[e.jsxs(W,{children:[e.jsx(Q,{children:"Konfirmasi Perubahan"}),e.jsx(X,{children:"Apakah Anda yakin ingin menyimpan perubahan data klinik ini? Pastikan seluruh informasi yang dimasukkan sudah benar."})]}),e.jsxs(Z,{children:[e.jsx(Y,{children:"Batal"}),e.jsx(ee,{className:"bg-emerald-600 hover:bg-emerald-700",onClick:()=>f(),children:"Simpan"})]})]})})]})]})}export{Le as default};
