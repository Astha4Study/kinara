import{r as p,j as e,L as Y,G as v,H as G,t as j,b as w,s as W}from"./app-CgQ5_Exw.js";import{H as f}from"./highlight-CEnwrJFs.js";import{C as q}from"./chevron-up-cdqRfUM-.js";import{C as $}from"./chevron-down-DPMERgs6.js";import{D as z}from"./data-pemeriksaan-fisik-BUgpPoZ-.js";import{A,b as S,c as L,d as T,g as F,e as P,f as B,h as R}from"./alert-dialog-Ib_-xiso.js";import{S as J}from"./switch-BOSOoXe9.js";import{A as Q}from"./app-layout-t2dowiqj.js";import{u as V}from"./catatan-layanan.store-D8FcHDWS.js";import"./app-BKSfwL7n.js";import"./utils-B4smH_VX.js";import"./index-CwTnP0Ax.js";import"./index-Bg-JEsM4.js";import"./index-D6pdehZ5.js";import"./index-CJy58a3f.js";import"./avatar-CqAQLXEM.js";import"./button-BJRDkhjt.js";import"./index-CTQlcuF6.js";import"./index-Dt6uqdf4.js";import"./index-DYp1igiw.js";import"./index-4Ns3tNZl.js";import"./settings-tEfU3Xeu.js";import"./users-D_KveccA.js";import"./react-QHy7mJCH.js";const X=a=>{if(!a)return"-";const t=new Date(a);return isNaN(t.getTime())?"-":t.toLocaleDateString("id-ID")},Z=a=>{if(!a)return"-";const t=new Date(a);if(isNaN(t.getTime()))return"-";const r=new Date;let d=r.getFullYear()-t.getFullYear();const m=r.getMonth()-t.getMonth();return(m<0||m===0&&r.getDate()<t.getDate())&&d--,`${d} tahun`},ee=({pasien:a})=>{const[t,r]=p.useState(!1);return e.jsx("div",{className:"overflow-hidden rounded-lg border border-gray-200 bg-white shadow-sm",children:e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Informasi Pasien"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Data identitas pasien"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(f,{label:"Nomor Pasien",value:a.nomor_pasien}),e.jsx(C,{label:"Nama Lengkap",value:a.nama_lengkap}),e.jsx(C,{label:"Umur",value:Z(a.tanggal_lahir)}),e.jsx(C,{label:"Tanggal Lahir",value:X(a.tanggal_lahir)}),t&&e.jsxs(e.Fragment,{children:[e.jsx(f,{label:"Golongan Darah",value:a.golongan_darah}),e.jsx(f,{label:"Riwayat Penyakit",value:a.riwayat_penyakit}),e.jsx(f,{className:"col-span-1 md:col-span-2",label:"Alergi",value:a.alergi,multiline:!0})]})]}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("button",{type:"button",onClick:()=>r(!t),className:"inline-flex items-center text-sm text-emerald-600",children:t?e.jsxs(e.Fragment,{children:["Tampilkan Lebih Sedikit",e.jsx(q,{className:"ml-1 h-4 w-4"})]}):e.jsxs(e.Fragment,{children:["Tampilkan Lebih Banyak",e.jsx($,{className:"ml-1 h-4 w-4"})]})})})]})})};function C({label:a,value:t}){return e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:a}),e.jsx("input",{disabled:!0,value:t,className:"w-full rounded-lg border border-gray-200 bg-gray-50 px-4 py-2.5 text-sm text-gray-700"})]})}function ae({punyaServer:a,butuhResep:t,data:r,setData:d,handleSubmit:m,processing:h,errors:c}){const o=i=>d(i.target.name,i.target.value);return e.jsxs("form",{onSubmit:m,className:"overflow-hidden rounded-lg border border-gray-200 bg-white shadow-sm",children:[e.jsxs("div",{className:"space-y-4 p-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Keluhan Utama"}),e.jsx("textarea",{readOnly:!0,rows:3,value:r.keluhan_utama||"-",className:"w-full cursor-not-allowed rounded-lg border border-gray-200 bg-gray-100 px-4 py-2.5 text-sm"})]}),a===1?e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:["Detail Keluhan"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{name:"detail_keluhan",value:r.detail_keluhan,onChange:o,rows:3,required:!0,placeholder:"Jelaskan lebih detail keluhan pasien",className:"w-full rounded-lg border border-gray-200 bg-white px-4 py-2.5 text-sm"}),c.detail_keluhan&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.detail_keluhan})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:["Diagnosa ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"diagnosa",value:r.diagnosa,onChange:o,required:!0,placeholder:"Contoh: Gastritis, ISPA",className:"w-full rounded-lg border border-gray-200 bg-white px-4 py-2.5 text-sm"}),c.diagnosa&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.diagnosa})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:["Tindakan ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"tindakan",value:r.tindakan,onChange:o,required:!0,placeholder:"Contoh: Resep obat, Rujuk",className:"w-full rounded-lg border border-gray-200 bg-white px-4 py-2.5 text-sm"}),c.tindakan&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.tindakan})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Catatan Lain (Opsional)"}),e.jsx("textarea",{name:"catatan_lain",value:r.catatan_lain,onChange:o,rows:2,placeholder:"Catatan tambahan (opsional)",className:"w-full rounded-lg border border-gray-200 bg-white px-4 py-2.5 text-sm"}),c.catatan_lain&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:c.catatan_lain})]})]}):e.jsxs("div",{className:"rounded-xl border border-emerald-200 bg-emerald-50 p-6 text-center shadow-sm",children:[e.jsx("div",{className:"mx-auto mb-3 flex h-12 w-12 items-center justify-center rounded-full bg-emerald-100",children:e.jsx("svg",{className:"h-6 w-6 text-emerald-600",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.79 1.732-3L13.732 4c-.77-1.79-2.502-1.79-3.268 0L3.34 16c-.77 1.79.192 3 1.732 3z"})})}),e.jsx("h3",{className:"mb-1 text-sm font-semibold text-emerald-800",children:"Mode Tanpa Server"}),e.jsx("p",{className:"text-sm text-emerald-700",children:"Data rekam medis lengkap dicatat secara manual. Informasi yang tersimpan otomatis hanya nomor pasien, nama, dan keluhan utama."})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t bg-gray-50 px-6 py-4",children:[e.jsx(Y,{href:"/dokter/antrian",className:"rounded-lg border px-4 py-2.5 text-sm",children:"Batal"}),e.jsx("button",{type:"submit",disabled:h,className:"rounded-lg bg-emerald-600 px-4 py-2.5 text-sm font-medium text-white hover:bg-emerald-700 disabled:opacity-50",children:h?"Menyimpan...":t?"Siapkan Resep":"Simpan Tindakan"})]})]})}const se=({layanan_list:a=[],onChange:t,errors:r={}})=>{const[d,m]=p.useState([]),h=s=>a.filter(n=>n.id===0||n.id===d[s]?.layanan_id||!d.some(l=>l.layanan_id===n.id)),c=()=>{m(s=>[...s,{layanan_id:0,nama_layanan:""}])},o=s=>{m(n=>n.filter((l,x)=>x!==s))},i=(s,n,l)=>{m(x=>{const u=[...x];return u[s]={...u[s],[n]:l},u})},y=(s,n)=>{const l=a.find(x=>x.id===n);l&&(i(s,"layanan_id",l.id),i(s,"nama_layanan",l.nama_layanan))};return p.useEffect(()=>{t(d)},[d]),e.jsx("div",{className:"rounded-xl border border-gray-200 bg-white shadow-sm",children:e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"space-y-4",children:[d.map((s,n)=>e.jsxs("div",{className:"rounded-lg border border-gray-200 p-4",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-500",children:["Layanan ke-",n+1]}),e.jsx("button",{type:"button",onClick:()=>o(n),className:"text-xs text-red-600 hover:underline",children:"Hapus"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Layanan"}),e.jsxs("select",{value:s.layanan_id,onChange:l=>y(n,Number(l.target.value)),className:"w-full rounded-lg border px-3 py-2 text-sm",children:[e.jsx("option",{value:0,children:"-- Pilih Layanan --"}),h(n).map(l=>e.jsx("option",{value:l.id,children:l.nama_layanan},l.id))]})]})]},n)),e.jsx("button",{type:"button",onClick:c,className:"w-full rounded-lg border border-dashed border-gray-300 px-4 py-3 text-sm text-gray-600 hover:border-emerald-500 hover:text-emerald-600",children:"+ Tambah Layanan"})]}),r.general&&e.jsx("p",{className:"text-sm text-red-600",children:r.general})]})})},te=["Umum","Kebidanan & Kandungan","Anak","Kulit & Kelamin","Fisioterapi"];function Ae({pasien:a,klinik:t,antrian:r,punya_server:d,punya_apoteker:m,pemeriksaan_fisik:h,layanan:c}){const{data:o,setData:i,reset:y,setProcessing:s,setErrors:n,processing:l,errors:x}=V(),[u,D]=v.useState(m===!1?!1:o.butuh_resep),[E,k]=v.useState(!1),[O,N]=v.useState(!1),_=!!t?.jenis_klinik&&te.includes(t.jenis_klinik);p.useEffect(()=>{y()},[]),p.useEffect(()=>{i("antrian_id",r.id),i("pasien_id",a.id),i("klinik_id",t.id),i("keluhan_utama",r.keluhan??""),_&&h&&i("pemeriksaan_fisik_id",h.id)},[r.id,a.id,t.id,h?.id]),p.useEffect(()=>{s(!1),n({})},[]),p.useEffect(()=>{i("butuh_resep",u)},[u]),p.useEffect(()=>{m===!1&&(D(!1),i("butuh_resep",!1))},[m]);const K=g=>{if(g.preventDefault(),!l){if(n({}),s(!0),!o.layanan.some(b=>b.layanan_id!==0)){n({general:"Pilih minimal 1 layanan untuk pasien."}),j.error("Pilih minimal 1 layanan untuk pasien."),s(!1);return}if(d===1){const b=U=>!String(U||"").trim();if(b(o.detail_keluhan)||b(o.diagnosa)||b(o.tindakan)){n({detail_keluhan:"Wajib diisi",diagnosa:"Wajib diisi",tindakan:"Wajib diisi"}),j.error("Lengkapi data rekam medis terlebih dahulu"),s(!1);return}}if(!u){N(!0),s(!1);return}k(!0),s(!1)}},M=()=>{k(!1),s(!0),w.visit(`/dokter/antrian/${r.id}/resep/create`)},H=()=>{N(!1),s(!0),w.post(W("dokter.resep.final-store"),{catatan:o},{onFinish:()=>s(!1),onSuccess:()=>{j.success("Tindakan berhasil disimpan"),w.visit("/dokter/antrian")},onError:g=>{j.error("Gagal menyimpan tindakan"),n(g)}})},I=[{title:"Daftar Antrian",href:"/dokter/antrian"},{title:"Buat Tindakan Dokter",href:""}];return e.jsxs(Q,{breadcrumbs:I,children:[e.jsx(G,{title:"Buat Tindakan Dokter"}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-2xl font-semibold text-gray-900",children:["Buat Tindakan untuk ",a.nama_lengkap]}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Buat tindakan yang akan dilakukan"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(ee,{pasien:a}),_&&h&&e.jsx(z,{pemeriksaanFisik:h}),e.jsx(se,{layanan_list:c??[],onChange:g=>i("layanan",g),errors:{general:x.general}}),m&&e.jsx("div",{className:"rounded-xl border border-gray-200 bg-white p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900",children:["Resep Obat"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Apakah pasien memerlukan resep obat?"})]}),e.jsx(J,{className:"data-[state=checked]:bg-emerald-600",checked:u,onCheckedChange:D})]})}),e.jsx(ae,{punyaServer:d,butuhResep:u,data:o,setData:i,handleSubmit:K,processing:l,errors:x})]}),e.jsx(A,{open:E,onOpenChange:k,children:e.jsxs(S,{children:[e.jsxs(L,{children:[e.jsx(T,{children:d===0?"Apakah Anda sudah benar-benar mendata pasien ini?":"Apakah Anda sudah selesai mendata pasien ini?"}),e.jsx(F,{children:"Pastikan data pasien sudah sesuai sebelum menyimpan catatan layanan."})]}),e.jsxs(P,{children:[e.jsx(B,{children:"Batal"}),e.jsx(R,{className:"bg-emerald-600 hover:bg-emerald-700",onClick:M,children:"Ya, lanjut ke resep"})]})]})}),e.jsx(A,{open:O,onOpenChange:N,children:e.jsxs(S,{children:[e.jsxs(L,{children:[e.jsx(T,{children:"Konfirmasi Simpan Tanpa Resep"}),e.jsxs(F,{children:["Anda memilih untuk"," ",e.jsx("strong",{className:"text-red-500",children:"tidak membuat resep"}),". Tindakan akan langsung disimpan dan pasien dianggap selesai. Yakin ingin melanjutkan?"]})]}),e.jsxs(P,{children:[e.jsx(B,{children:"Batal"}),e.jsx(R,{className:"bg-emerald-600 hover:bg-emerald-700",onClick:H,children:"Ya, Simpan Tanpa Resep"})]})]})})]})]})}export{Ae as default};
