import{j as e,r as u,L as D,c as R,H as A,s as C,t as b}from"./app-Ocq4icyJ.js";import{H as j}from"./highlight-BJFkuN9F.js";import{D as O}from"./data-pemeriksaan-fisik-B3Pbgqzr.js";import{T as S}from"./trash-2-Oh06UI2F.js";import{A as P,b as L,c as F,d as H,e as T,f as M,g as E,h as B}from"./alert-dialog-BEkTNufo.js";import{A as z}from"./app-layout-CvpzEEPm.js";import"./app-C5lo-_3G.js";import"./utils-Ds7cxrxR.js";import"./index-BMVo49-9.js";import"./index-DxN2IpeV.js";import"./index-CY_07Mx7.js";import"./index-D_nX7TNC.js";import"./avatar-p7XMLe9B.js";import"./button-DsBpidke.js";import"./index-Dcn7FtQn.js";import"./index-6sq2BDXy.js";import"./index-4Ns3tNZl.js";import"./settings-CxkdKHPl.js";import"./users-udHOKson.js";const I=({pasien:s,diagnosa:n,punya_server:l})=>{const x=s.riwayat_penyakit&&s.riwayat_penyakit.trim()!==""&&s.riwayat_penyakit!=="-",d=n&&n.trim()!==""&&n!=="-";return e.jsx("div",{className:"rounded-lg border border-gray-200 bg-white shadow-sm",children:e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Informasi Pasien & Diagnosa"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Data identitas pasien dan hasil pemeriksaan dokter"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Nomor Pasien"}),e.jsx("div",{className:"rounded-lg border bg-gray-50 px-4 py-2.5 text-sm text-gray-900",children:s.nomor_pasien})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Nama Lengkap"}),e.jsx("div",{className:"rounded-lg border bg-gray-50 px-4 py-2.5 text-sm text-gray-900",children:s.nama_lengkap})]})]}),x&&e.jsx(j,{label:"Riwayat Penyakit",value:s.riwayat_penyakit,className:"mt-2"}),e.jsx("div",{className:"mt-2",children:l===1&&d?e.jsx(j,{label:"Diagnosa Dokter",value:n}):e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",disabled:!0,value:"Data ditulis manual, jangan lupa dicek kembali",className:"w-full rounded-lg border border-emerald-200 bg-emerald-50 px-4 py-2.5 pr-10 text-sm font-medium text-emerald-800"}),e.jsx("span",{className:"pointer-events-none absolute inset-y-0 right-3 flex items-center",children:e.jsx("svg",{className:"h-5 w-5 text-emerald-600",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.79 1.732-3L13.732 4c-.77-1.79-2.502-1.79-3.268 0L3.34 16c-.77 1.79.192 3 1.732 3z"})})})]})})]})})};function $({resep_teks:s}){return e.jsx("div",{className:"mb-6 rounded-lg border border-gray-200 bg-white shadow-sm",children:e.jsxs("div",{className:"space-y-4 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Resep Medis Dokter"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Resep yang ditulis oleh dokter sebagai acuan penyiapan obat"})]}),e.jsx("span",{className:"rounded-md bg-emerald-50 px-3 py-1 text-xs font-semibold text-emerald-700",children:"Resep Dokter"})]}),e.jsx("div",{className:"mt-4",children:e.jsx("textarea",{rows:4,value:s||"-",disabled:!0,className:"w-full resize-none rounded-md border border-gray-200 bg-gray-50 px-3 py-2 text-sm leading-relaxed text-gray-700"})})]})})}function q({obat_list:s,processing:n,errors:l,onConfirm:x,onChange:d,pasien:p}){const[i,g]=u.useState([]),y=()=>g(a=>[...a,{obat_id:0,nama_obat:"",jumlah:1,satuan:"",harga:0,subtotal:0,penggunaan_obat:""}]),o=(a,r,t)=>{g(m=>{const c=[...m];if(c[a]={...c[a],[r]:t},r==="jumlah"||r==="harga"||r==="obat_id"){const w=r==="obat_id"?s.find(_=>_.id===t)?.harga??c[a].harga:c[a].harga;c[a].subtotal=c[a].jumlah*w}return c})},f=a=>g(r=>r.filter((t,m)=>m!==a)),N=i.reduce((a,r)=>a+r.harga*r.jumlah,0),h=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a),k=(a,r)=>{const t=s.find(m=>m.id===r);t&&(o(a,"obat_id",r),o(a,"nama_obat",t.nama_obat),o(a,"satuan",t.satuan),o(a,"harga",t.harga),o(a,"penggunaan_obat",t.penggunaan_obat))},v=a=>{a.preventDefault(),i.length!==0&&x()};return u.useEffect(()=>{d(i)},[i]),e.jsx("form",{onSubmit:v,children:e.jsxs("div",{className:"rounded-xl border shadow-sm",children:[e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"space-y-4",children:[i.map((a,r)=>e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-white p-4 shadow-sm",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-500",children:["Obat ke-",r+1]}),e.jsxs("button",{type:"button",onClick:()=>f(r),className:"inline-flex items-center gap-1 rounded-full bg-red-100 px-3 py-1 text-xs font-medium text-red-600 hover:bg-red-200",children:[e.jsx(S,{size:14})," Hapus"]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Nama Obat"}),e.jsxs("select",{value:a.obat_id,onChange:t=>k(r,Number(t.target.value)),required:!0,className:"w-full rounded-lg border border-gray-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:0,children:"-- Pilih Obat --"}),s.map(t=>e.jsxs("option",{value:t.id,children:[t.nama_obat," (",t.satuan,")"]},t.id))]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:["Jumlah"," ",e.jsx("span",{className:"text-emerald-600",children:a.obat_id?`(Stok: ${s.find(t=>t.id===a.obat_id)?.stok??0})`:""})]}),e.jsx("input",{type:"number",min:1,max:s.find(t=>t.id===a.obat_id)?.stok??1,value:a.jumlah,onChange:t=>o(r,"jumlah",Math.min(Number(t.target.value),s.find(m=>m.id===a.obat_id)?.stok??1)),className:"w-full rounded-lg border border-gray-200 px-3 py-2 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Harga Satuan"}),e.jsx("input",{type:"text",value:h(a.harga),readOnly:!0,className:"w-full cursor-not-allowed rounded-lg border border-gray-200 bg-gray-50 px-3 py-2 text-sm text-gray-600"})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Aturan Pakai"}),e.jsx("input",{type:"text",value:a.penggunaan_obat,onChange:t=>o(r,"penggunaan_obat",t.target.value),placeholder:"3Ã—1 sehari",className:"w-full rounded-lg border border-gray-200 px-3 py-2 text-sm"})]})]})]},r)),e.jsx("button",{type:"button",onClick:y,disabled:i.some(a=>a.obat_id&&(s.find(r=>r.id===a.obat_id)?.stok??0)===0),className:"w-full rounded-lg border border-dashed border-gray-300 px-4 py-3 text-sm text-gray-600 hover:border-emerald-500 hover:text-emerald-600",children:"+ Tambah Obat"})]}),l.general&&e.jsx("p",{className:"text-sm text-red-600",children:l.general}),e.jsxs("div",{className:"flex items-center justify-between rounded-xl border border-gray-200 bg-white px-5 py-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Total"}),e.jsx("span",{className:"rounded-md bg-emerald-50 px-2.5 py-1 text-xs font-semibold text-emerald-700",children:"Sudah termasuk PPN"})]}),e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"Rp"}),e.jsx("span",{className:"text-xl font-semibold tracking-tight text-gray-900",children:h(N).replace("Rp","")})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 rounded-b-xl border-t border-gray-200 bg-gray-50 px-6 py-4",children:[e.jsx(D,{href:`/dokter/antrian/${p.id}/tangani`,className:"rounded-lg border border-gray-200 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Batal"}),e.jsx("button",{type:"submit",disabled:n||i.length===0,className:"rounded-lg bg-emerald-600 px-4 py-2 text-sm font-medium text-white hover:bg-emerald-700 disabled:opacity-50",children:n?"Menyimpan...":"Simpan Resep"})]})]})})}const J=[{title:"Resep Masuk",href:"/apoteker/resep-masuk"},{title:"Siapkan Obat Pasien",href:""}];function me({resep:s,obatMaster:n}){const l=R({detail:[]}),[x,d]=u.useState(!1),p=()=>{l.post(C("apoteker.resep-detail.store",s.id),{preserveScroll:!0,onSuccess:()=>{d(!1),b.success("Resep berhasil dibuat")},onError:()=>{b.error("Terjadi kesalahan saat membuat resep")}})};return e.jsxs(z,{breadcrumbs:J,children:[e.jsx(A,{title:"Siapkan Obat Pasien"}),e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsx(I,{pasien:s.pasien,diagnosa:s.diagnosa,punya_server:s.punya_server}),e.jsx(O,{pemeriksaanFisik:s.pemeriksaan_fisik})]}),e.jsx($,{resep_teks:s.resep_teks}),e.jsx(q,{obat_list:n,processing:l.processing,errors:l.errors,pasien:s.pasien,onChange:i=>l.setData("detail",i),onConfirm:()=>d(!0)})]}),e.jsx(P,{open:x,onOpenChange:d,children:e.jsxs(L,{children:[e.jsxs(F,{children:[e.jsx(H,{children:"Konfirmasi Pengecekan Obat"}),e.jsx(T,{children:"Apakah kamu yakin sudah mengecek obat dengan baik dan sesuai dengan resep dokter?"})]}),e.jsxs(M,{children:[e.jsx(E,{disabled:l.processing,children:"Batal"}),e.jsx(B,{onClick:p,disabled:l.processing,className:"bg-emerald-600 hover:bg-emerald-700",children:"Ya, Sudah Dicek"})]})]})})]})}export{me as default};
